<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… | I.TECH</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="preload" as="style" onload="this.rel='stylesheet'">
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&display=swap" rel="preload" as="style" onload="this.rel='stylesheet'">
  <noscript><link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet"></noscript>
  <noscript><link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&display=swap" rel="stylesheet"></noscript>
  <link rel="stylesheet" href="./css/main.css" />
  <link rel="icon" type="image/png" href="./assets/images/I-Tech logo.png" />
</head>
<body class="page-controll">
  <div id="login-overlay" style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(248,250,252,0.98);z-index:9999;display:flex;align-items:center;justify-content:center;flex-direction:column;">
    <div class="card" style="max-width:400px;width:90%;text-align:center;padding:40px;">
      <div style="margin-bottom:20px;">
        <img src="./assets/images/I-Tech logo.png" alt="Logo" style="width:80px;height:80px;">
      </div>
      <h2 style="margin-bottom:24px;">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</h2>
      <div class="form">
        <input type="text" id="admin-user" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" style="margin-bottom:12px;text-align:center;">
        <input type="password" id="admin-pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" style="margin-bottom:16px;text-align:center;">
        <button class="btn primary" id="btn-login" style="width:100%;">Ø¯Ø®ÙˆÙ„</button>
        <p id="login-error" style="color:#ef4444;display:none;margin-top:12px;font-weight:bold;">ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</p>
      </div>
    </div>
  </div>
  <script>
    // Ù…Ù„Ø§Ø­Ø¸Ø© Ø£Ù…Ù†ÙŠØ©: Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± ÙÙŠ Ù…Ù„ÙØ§Øª Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©.
    // Ø§Ù„Ø­Ù„: Ø§Ù„ØªØ­Ù‚Ù‚ ÙŠØªÙ… Ù…Ù† Ø¬Ù‡Ø© Ø®Ø§Ø¯Ù… (Web App) ÙˆÙŠØ¹ÙŠØ¯ Ø±Ù…Ø² ÙˆØµÙˆÙ„ (Token).
    const LOGIN_URL = window.ITECH_LOGIN_URL || 'https://script.google.com/macros/s/AKfycbxJL5THQR4YfjSYehmozhTeEkmUFmv70cJLJljVOxh3A7xqj7HIOJljPbn-MtxFPGybGA/exec'; // Ø§Ø¶Ø¨Ø·Ù‡ Ø¥Ù„Ù‰ Ø±Ø§Ø¨Ø· Ø§Ù„Ù†Ø´Ø± Ù…Ù† Google Apps Script
    const elOverlay = document.getElementById('login-overlay');
    const elErr = document.getElementById('login-error');
    const elBtn = document.getElementById('btn-login');
    async function doLogin(){
      elErr.style.display = 'none';
      const u = (document.getElementById('admin-user').value||'').trim();
      const p = (document.getElementById('admin-pass').value||'').trim();
      if(!LOGIN_URL || LOGIN_URL.includes('YOUR_APPS_SCRIPT_WEBAPP_URL')){
        elErr.textContent = 'Ø®Ø¯Ù…Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± Ù…ÙØ¹Ø¯Ø©. Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªÙ‡ÙŠØ¦Ø© Ø±Ø§Ø¨Ø· Ø§Ù„Ø®Ø§Ø¯Ù….';
        elErr.style.display = 'block';
        return;
      }
      try {
        elBtn.disabled = true;
        const url = `${LOGIN_URL}?action=login&user=${encodeURIComponent(u)}&pass=${encodeURIComponent(p)}`;
        const r = await fetch(url, { method: 'GET', credentials: 'omit' });
        const j = await r.json();
        if(j && j.ok && j.token){
          sessionStorage.setItem('itech_token', j.token);
          elOverlay.style.opacity = '0';
          setTimeout(()=>{ elOverlay.style.display = 'none'; }, 300);
        } else {
          elErr.textContent = 'Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©';
          elErr.style.display = 'block';
        }
      } catch(e){
        elErr.textContent = 'ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…';
        elErr.style.display = 'block';
      } finally {
        elBtn.disabled = false;
      }
    }
    document.getElementById('btn-login').addEventListener('click', doLogin);
  </script>
  <header class="nav">
    <div class="brand">
      <div class="logo-circle">
        <img src="./assets/images/I-Tech logo.png" alt="Ø´Ø¹Ø§Ø± Ø§ÙŠØªÙƒ I.TECH" />
      </div>
      <div class="names">
        <div class="ar">Ø§ÙŠØªÙƒ</div>
        <div class="en">I.TECH</div>
      </div>
    </div>
    <nav class="menu">
      <a href="index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
      <a href="tenders-new.html">Ù…Ù†Ø§Ù‚ØµØ§Øª Ø§Ù„Ø¹Ø±Ø§Ù‚</a>
      <a href="about.html">Ù…Ù† Ù†Ø­Ù†</a>
      <a href="services.html">Ø§Ù„Ø®Ø¯Ù…Ø§Øª</a>
      <a href="contact.html">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</a>
      <a href="add-tender.html" class="pill">Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø§Ù‚ØµØ©</a>
    </nav>
    <button class="burger" aria-label="ÙØªØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©" aria-expanded="false">â˜°</button>
  </header>
  

  <main class="container">
    <section class="card">
      <h1>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙÙˆØ±ÙŠØ© (Ù†Ø³Ø®Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©)</h1>
      <div class="grid-3">
        <div class="stat card"><div class="label">Ø²ÙŠØ§Ø±Ø§Øª Ø§Ù„ÙŠÙˆÙ…</div><div id="visitsToday" class="value">0</div></div>
        <div class="stat card"><div class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª</div><div id="visitsTotal" class="value">0</div></div>
        <div class="stat card"><div class="label">Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„</div><div id="contacts" class="value">0</div></div>
      </div>
      <p class="muted">Ù‡Ø°Ù‡ Ù†Ø³Ø®Ø© Ø£ÙˆÙ„ÙŠØ© Ø¨Ø¯ÙˆÙ† Ø®Ø§Ø¯Ù…. ØªÙØ®Ø²Ù‘ÙÙ† Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­.</p>
    </section>

    <!-- Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬: Ø¯Ø§Ø®Ù„ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
    <section class="card" id="programAdmin">
      <h1>Ø¥Ø¶Ø§ÙØ© Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¬Ø¯ÙŠØ¯</h1>
      <p>Ø§Ù…Ù„Ø£ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø«Ù… Ø§Ø¶ØºØ· "Ù†Ø´Ø± Ø¹Ù„Ù‰ GitHub" Ù„ÙŠÙØ­Ø¯Ù‘Ø« Ø§Ù„Ù…Ù„Ù <strong>assets/data/programs.json</strong> Ù…Ø¨Ø§Ø´Ø±Ø© ÙˆÙŠØ¸Ù‡Ø± ÙÙŠ ØµÙØ­Ø© "Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬".</p>
      <div class="grid-2">
        <div>
          <div class="form">
            <label>Ø§Ø³Ù… Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬</label>
            <input id="p_name" placeholder="Ù…Ø«Ø§Ù„: Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø®Ø²ÙˆÙ†" />
            <label>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ù† Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬</label>
            <textarea id="p_desc" rows="3" placeholder="ÙˆØµÙ Ù…ÙˆØ¬Ø²"></textarea>
            <label>Ø±Ø§Ø¨Ø· Ù„ÙˆØºÙˆ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬</label>
            <input id="p_logo" placeholder="https://..." />
            <label>Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</label>
            <input id="p_image" placeholder="https://..." />
            <label>Ø³Ø¹Ø± Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬</label>
            <input id="p_price" type="number" placeholder="Ù…Ø«Ø§Ù„: 250" />
            <label>Ø§Ù„Ø¹Ù…Ù„Ø©</label>
            <select id="p_currency">
              <option value="IQD" selected>Ø¯ÙŠÙ†Ø§Ø±</option>
              <option value="USD">Ø¯ÙˆÙ„Ø§Ø±</option>
            </select>
            <input id="p_id" type="hidden" />

            <h2 style="margin:14px 0 10px;">Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬</h2>
            <div style="background:var(--bg-hover);padding:12px;border-radius:8px;margin-bottom:12px;">
              <p class="muted" style="margin-bottom:12px;font-size:12px;">ğŸ’¡ Ø§Ø³ØªØ®Ø¯Ù… Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø£Ø¯Ù†Ø§Ù‡ Ù„Ø¥Ø¶Ø§ÙØ© Ù…ÙŠØ²Ø§Øª Ù…Ù†Ø³Ù‚Ø©. Ø£Ùˆ Ø§ÙƒØªØ¨ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨ØµÙŠØºØ© Ø¨Ø³ÙŠØ·Ø© (Ø§ÙØµÙ„ Ø¨Ù€ <strong>;</strong>)</p>
              
              <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù†ØµÙŠ -->
              <div id="textFormattingToolbar" style="background:var(--surface);border:1px solid var(--border);border-radius:6px;padding:8px;margin-bottom:12px;display:flex;gap:2px;flex-wrap:wrap;align-items:center;">
                <!-- Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ -->
                <button id="fmt-bold" class="fmt-btn" title="Ø¹Ø±ÙŠØ¶ (Ctrl+B)" style="padding:6px 10px;background:var(--surface);border:1px solid var(--border);border-radius:4px;cursor:pointer;font-weight:bold;color:var(--text-main);">B</button>
                <button id="fmt-italic" class="fmt-btn" title="Ù…Ø§Ø¦Ù„ (Ctrl+I)" style="padding:6px 10px;background:var(--surface);border:1px solid var(--border);border-radius:4px;cursor:pointer;font-style:italic;color:var(--text-main);">I</button>
                <button id="fmt-underline" class="fmt-btn" title="ØªØ³Ø·ÙŠØ± (Ctrl+U)" style="padding:6px 10px;background:var(--surface);border:1px solid var(--border);border-radius:4px;cursor:pointer;text-decoration:underline;color:var(--text-main);">U</button>
                
                <!-- ÙØ§ØµÙ„ -->
                <div style="width:1px;height:20px;background:var(--border);margin:0 4px;"></div>
                
                <!-- Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ© -->
                <label title="Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ©" style="display:flex;align-items:center;gap:4px;cursor:pointer;">
                  <input type="color" id="fmt-bgcolor" value="#ffffff" style="width:30px;height:30px;border:1px solid var(--border);border-radius:4px;cursor:pointer;">
                  <span style="font-size:11px;color:var(--text-muted);">â—¼</span>
                </label>
                
                <!-- ÙØ§ØµÙ„ -->
                <div style="width:1px;height:20px;background:var(--border);margin:0 4px;"></div>
                
                <!-- Ø­Ø¬Ù… Ø§Ù„Ø®Ø· -->
                <select id="fmt-size" title="Ø­Ø¬Ù… Ø§Ù„Ø®Ø·" style="padding:6px;border:1px solid var(--border);border-radius:4px;font-size:12px;background:var(--surface);color:var(--text-main);">
                  <option value="12">12</option>
                  <option value="14" selected>14</option>
                  <option value="16">16</option>
                  <option value="18">18</option>
                  <option value="20">20</option>
                </select>

                <!-- ØªØ¨Ø§Ø¹Ø¯ Ø§Ù„Ø£Ø³Ø·Ø± -->
                <select id="fmt-lineheight" title="ØªØ¨Ø§Ø¹Ø¯ Ø§Ù„Ø£Ø³Ø·Ø±" style="padding:6px;border:1px solid var(--border);border-radius:4px;font-size:12px;background:var(--surface);color:var(--text-main);margin-right:4px;">
                  <option value="1.4">1.4</option>
                  <option value="1.6" selected>1.6</option>
                  <option value="1.8">1.8</option>
                  <option value="2">2.0</option>
                </select>
                
                <!-- ÙØ§ØµÙ„ -->
                <div style="width:1px;height:20px;background:var(--border);margin:0 4px;"></div>
                
                <!-- ØªÙ… ØªØ«Ø¨ÙŠØª Ù†ÙˆØ¹ Ø§Ù„Ø®Ø· Ø¹Ù„Ù‰ TajawalØŒ Ù„Ø°Ø§ Ø£Ø²ÙŠÙ„Øª Ù‚Ø§Ø¦Ù…Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø®Ø· -->

                <!-- Ù…Ø­Ø§Ø°Ø§Ø© Ø§Ù„ÙÙ‚Ø±Ø© -->
                <button id="fmt-align-right" class="fmt-btn" title="Ù…Ø­Ø§Ø°Ø§Ø© ÙŠÙ…ÙŠÙ†" style="padding:6px 8px;background:var(--surface);border:1px solid var(--border);border-radius:4px;cursor:pointer;color:var(--text-main);">ÙŠÙ…ÙŠÙ†</button>
                <button id="fmt-align-center" class="fmt-btn" title="Ù…Ø­Ø§Ø°Ø§Ø© ÙˆØ³Ø·" style="padding:6px 8px;background:var(--surface);border:1px solid var(--border);border-radius:4px;cursor:pointer;color:var(--text-main);">ÙˆØ³Ø·</button>
                <button id="fmt-align-left" class="fmt-btn" title="Ù…Ø­Ø§Ø°Ø§Ø© ÙŠØ³Ø§Ø±" style="padding:6px 8px;background:var(--surface);border:1px solid var(--border);border-radius:4px;cursor:pointer;color:var(--text-main);">ÙŠØ³Ø§Ø±</button>

                <!-- ÙØ§ØµÙ„ -->
                <div style="width:1px;height:20px;background:var(--border);margin:0 4px;"></div>

                <!-- ØªØ¹Ø¯Ø§Ø¯ Ù†Ù‚Ø·ÙŠ ÙˆØ±Ù‚Ù…ÙŠ -->
                <button id="fmt-ul" class="fmt-btn" title="Ù‚Ø§Ø¦Ù…Ø© Ù†Ù‚Ø·ÙŠØ©" style="padding:6px 8px;background:var(--surface);border:1px solid var(--border);border-radius:4px;cursor:pointer;color:var(--text-main);">â€¢ â€¢</button>
                <button id="fmt-ol" class="fmt-btn" title="Ù‚Ø§Ø¦Ù…Ø© Ø±Ù‚Ù…ÙŠØ©" style="padding:6px 8px;background:var(--surface);border:1px solid var(--border);border-radius:4px;cursor:pointer;color:var(--text-main);">1.</button>
                
                <!-- ÙØ§ØµÙ„ -->
                <div style="width:1px;height:20px;background:var(--border);margin:0 4px;"></div>
                
                <!-- Ù…Ø´Ø§Ø±ÙƒØ§Øª Ø³Ø±ÙŠØ¹Ø© -->
                <button id="fmt-emoji" class="fmt-btn" title="Ø£ÙŠÙ‚ÙˆÙ†Ø©" style="padding:6px 10px;background:var(--surface);border:1px solid var(--border);border-radius:4px;cursor:pointer;color:var(--text-main);">ğŸ˜Š</button>
                
                <!-- Ø²Ø± Ù…Ø³Ø­ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ -->
                <button id="fmt-clear" class="fmt-btn" title="Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙ†Ø³ÙŠÙ‚" style="padding:6px 10px;background:#fee2e2;border:1px solid #fecaca;border-radius:4px;cursor:pointer;color:#dc2626;font-size:12px;">âœ•</button>
              </div>
              
              <!-- Ø­Ù‚Ù„ Ø§Ù„Ù†Øµ Ø¨Ù…Ø¹Ø§ÙŠÙ†Ø© -->
              <div style="display:grid;grid-template-columns:1fr;gap:12px;margin-bottom:12px;">
                <div>
                  <label style="display:block;font-size:12px;font-weight:600;margin-bottom:4px;color:var(--text-main);">Ø§Ù„Ù†Øµ:</label>
                  <textarea id="feat-text-rich" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù†Øµ Ù‡Ù†Ø§..." style="width:100%;padding:8px;border:1px solid var(--border);border-radius:4px;background:var(--surface);color:var(--text-main);font-family:'Tajawal', sans-serif;resize:vertical;min-height:150px;"></textarea>
                </div>
                <div>
                  <label style="display:block;font-size:12px;font-weight:600;margin-bottom:4px;color:var(--text-main);">Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©:</label>
                  <div id="feat-preview-text" style="width:100%;padding:8px;border:1px solid var(--border);border-radius:4px;background:var(--surface);color:var(--text-main);min-height:100px;word-wrap:break-word;overflow-y:auto;"></div>
                </div>
              </div>
              
              <!-- Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© -->
              <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-bottom:12px;">
                <div>
                  <label style="display:block;font-size:12px;font-weight:600;margin-bottom:4px;color:var(--text-main);">Ø§Ù„Ø±Ø§Ø¨Ø· (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
                  <input type="text" id="feat-link" placeholder="https://..." style="width:100%;padding:8px;border:1px solid var(--border);border-radius:4px;background:var(--surface);color:var(--text-main);">
                </div>
                <div>
                  <label style="display:block;font-size:12px;font-weight:600;margin-bottom:4px;color:var(--text-main);">Ù„ÙˆÙ† Ø§Ù„Ø´Ø§Ø±Ø©:</label>
                  <select id="feat-color" style="width:100%;padding:8px;border:1px solid var(--border);border-radius:4px;background:var(--surface);color:var(--text-main);">
                    <option value="">Ø¨Ø¯ÙˆÙ† Ù„ÙˆÙ†</option>
                    <option value="#4ade80">ğŸŸ¢ Ø£Ø®Ø¶Ø±</option>
                    <option value="#60a5fa">ğŸ”µ Ø£Ø²Ø±Ù‚</option>
                    <option value="#fbbf24">ğŸŸ¡ Ø£ØµÙØ±</option>
                    <option value="#f87171">ğŸ”´ Ø£Ø­Ù…Ø±</option>
                    <option value="#a78bfa">ğŸŸ£ Ø¨Ù†ÙØ³Ø¬ÙŠ</option>
                  </select>
                </div>
                <div>
                  <label style="display:block;font-size:12px;font-weight:600;margin-bottom:4px;color:var(--text-main);">&nbsp;</label>
                  <button class="btn" id="btnAddFeature" style="width:100%;background:var(--primary);color:white;border:none;cursor:pointer;padding:8px;border-radius:4px;">â• Ø¥Ø¶Ø§ÙØ© Ù…ÙŠØ²Ø©</button>
                </div>
              </div>
              
              <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù…Ø¶Ø§ÙØ© -->
              <div id="featuresPreview" style="border:1px solid var(--border);border-radius:4px;padding:12px;background:var(--surface);color:var(--text-main);min-height:60px;max-height:200px;overflow-y:auto;">
                <p class="muted" style="margin:0;text-align:center;">Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù…ÙŠØ²Ø§Øª</p>
              </div>
            </div>
            <textarea id="p_features" rows="3" placeholder="Ù…Ø«Ø§Ù„: ØªÙ‚Ø§Ø±ÙŠØ± Ù…Ø§Ù„ÙŠØ©; ØµÙ„Ø§Ø­ÙŠØ§Øª Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†; ØªØµØ¯ÙŠØ± PDF" style="display:none;"></textarea>

            <hr style="margin:14px 0; opacity:.3;">
            <h2 style="margin:6px 0 10px;">ØµÙˆØ± Ø¥Ø¶Ø§ÙÙŠØ© (Ø­ØªÙ‰ 10 Ø±ÙˆØ§Ø¨Ø·)</h2>
            <div class="grid-2">
              <input id="p_img1" placeholder="https://..." />
              <input id="p_img2" placeholder="https://..." />
              <input id="p_img3" placeholder="https://..." />
              <input id="p_img4" placeholder="https://..." />
              <input id="p_img5" placeholder="https://..." />
              <input id="p_img6" placeholder="https://..." />
              <input id="p_img7" placeholder="https://..." />
              <input id="p_img8" placeholder="https://..." />
              <input id="p_img9" placeholder="https://..." />
              <input id="p_img10" placeholder="https://..." />
            </div>

            <h2 style="margin:14px 0 10px;">Ø±ÙˆØ§Ø¨Ø· ÙÙŠØ¯ÙŠÙˆ (Ø­ØªÙ‰ 2)</h2>
            <div class="grid-2">
              <input id="p_vid1" placeholder="https://..." />
              <input id="p_vid2" placeholder="https://..." />
            </div>

            <div id="programPublishStatus" style="margin-top:15px;padding:12px;border-radius:5px;display:none;font-weight:600;"></div>

            <hr style="margin:18px 0; opacity:.3;">
            <h2 style="margin:6px 0 10px;">Ù†Ø´Ø± Ù…Ø¨Ø§Ø´Ø± Ø¹Ù„Ù‰ GitHub</h2>
            <p class="muted">ÙŠØªØ·Ù„Ø¨ Ø±Ù…Ø² ÙˆØµÙˆÙ„ Ø´Ø®ØµÙŠ (PAT) Ø¨ØµÙ„Ø§Ø­ÙŠØ© contents:write Ù„Ù„Ù…Ø³ØªÙˆØ¯Ø¹.
              Ø³ÙŠØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ù <strong>assets/data/programs.json</strong> Ù…Ø¨Ø§Ø´Ø±Ø© Ø¹Ø¨Ø± GitHub API.
            </p>
            <div class="form">
              <label>GitHub Owner</label>
              <input id="pg_owner" value="abubesun-hub" placeholder="Ù…Ø«Ø§Ù„: abubesun-hub" />
              <label>GitHub Repo</label>
              <input id="pg_repo" value="I.tech" placeholder="Ù…Ø«Ø§Ù„: I.tech" />
              <label>Branch</label>
              <input id="pg_branch" value="main" />
              <label>Path Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹</label>
              <input id="pg_path" value="assets/data/programs.json" />
              <label>GitHub Token (PAT)</label>
              <input id="pg_token" type="password" placeholder="ghp_xxx" />
              <div style="display:flex;align-items:center;gap:10px;margin-top:8px;">
                <label style="display:flex;align-items:center;gap:6px;">
                  <input type="checkbox" id="pg_remember_token" />
                  Ø­ÙØ¸ Ø§Ù„Ø±Ù…Ø² Ù…Ø­Ù„ÙŠÙ‹Ø§ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                </label>
              </div>
              <div class="actions" style="margin-top:12px;">
                <button class="btn primary" id="btnPublishProgram">Ù†Ø´Ø± Ø¹Ù„Ù‰ GitHub</button>
                <button class="btn" id="btnTestPgConnection" style="margin-right:10px;">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„</button>
              </div>
            </div>
          </div>
        </div>
        <div>
          <h2>Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h2>
          <div class="actions" style="margin-bottom:8px;">
            <button class="btn" id="btnRefreshPrograms">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
            <button class="btn" id="btnClearProgramsCache">Ù…Ø³Ø­ ÙƒØ§Ø´ Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬</button>
          </div>
          <div id="programsAdminList" class="card" style="padding:12px;"></div>
        </div>
      </div>
    </section>
  </main>

  <footer class="footer">
    <div class="social">
      <a href="https://www.instagram.com/i.tech02/" target="_blank" rel="noopener" aria-label="Instagram">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="5"/><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"/></svg>
      </a>
        <a href="https://www.facebook.com/I.tech025/" target="_blank" rel="noopener" aria-label="Facebook">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M22 12a10 10 0 1 0-11.6 9.9v-7h-2.5V12h2.5V9.8c0-2.5 1.5-3.9 3.8-3.9 1.1 0 2.3.2 2.3.2v2.5h-1.3c-1.3 0-1.7.8-1.7 1.6V12h2.9l-.5 2.9h-2.4v7A10 10 0 0 0 22 12z"/></svg>
      </a>
      <a href="https://www.linkedin.com/in/itech-anbar/" target="_blank" rel="noopener" aria-label="LinkedIn">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M4.98 3.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5zM3 8.98h4v12H3v-12zM9 8.98h3.8v1.64h.05c.53-1 1.82-2.06 3.75-2.06 4 0 4.74 2.63 4.74 6.06v6.36h-4v-5.64c0-1.35-.02-3.09-1.88-3.09-1.88 0-2.17 1.47-2.17 3v5.73H9v-12z"/></svg>
      </a>
      <a href="https://www.tiktok.com/@user79508805600398" target="_blank" rel="noopener" aria-label="TikTok">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M17.5 6.1c1.2 1 2.7 1.6 4.3 1.7v3.1c-1.6 0-3.2-.4-4.6-1.2v5.8c0 3.7-3 6.5-6.7 6.5S3.8 19.2 3.8 15.5c0-3.7 3-6.7 6.7-6.7.5 0 1 .1 1.5.2v3.3c-.5-.2-1-.3-1.5-.3-2 0-3.6 1.6-3.6 3.6s1.6 3.5 3.6 3.5 3.6-1.6 3.6-3.6V2h3.4c.2 1.5 1 2.9 2.5 4.1z"/></svg>
      </a>
      <a href="https://www.youtube.com/@I.tech025" target="_blank" rel="noopener" aria-label="YouTube">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M23.5 6.2a3 3 0 0 0-2.1-2.1C19.4 3.5 12 3.5 12 3.5s-7.4 0-9.4.6A3 3 0 0 0 .5 6.2C0 8.2 0 12 0 12s0 3.8.5 5.8a3 3 0 0 0 2.1 2.1c2 .6 9.4 .6 9.4 .6s7.4 0 9.4-.6a3 3 0 0 0 2.1-2.1c.5-2 .5-5.8 .5-5.8s0-3.8-.5-5.8zM9.5 15.5v-7l6 3.5-6 3.5z"/></svg>
      </a>
      <a href="https://wa.me/9647817823680" target="_blank" rel="noopener" aria-label="WhatsApp">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M20 3.9A10 10 0 0 0 3.3 18.1L2 22l4-1.3A10 10 0 1 0 20 3.9zM12 4a8 8 0 0 1 0 16h-.1a8 8 0 0 1-4.2-1.2l-.3-.2-2.5.8.8-2.4-.2-.3A8 8 0 0 1 12 4zm4.5 9.7c-.2-.1-1.3-.6-1.5-.7-.2-.1-.3-.1-.5.1-.1.2-.6.7-.7.8-.1.1-.2.1-.4 0-.2-.1-.9-.3-1.7-1-.6-.5-1-1.2-1.1-1.4-.1-.2 0-.3.1-.4l.3-.3c.1-.1.1-.2.2-.3.1-.1.1-.2 0-.4-.1-.2-.5-1.2-.7-1.6-.2-.4-.4-.3-.5-.3h-.4c-.1 0-.4.1-.6.3-.2.2-.8.8-.8 1.9s.8 2.1.9 2.2c.1.1 1.6 2.5 3.9 3.4.5.2.9.3 1.2.4.5.2 1 .2 1.3.1.4-.1 1.3-.5 1.5-1 .2-.5.2-.9.1-1 0-.2-.1-.2-.3-.3z"/></svg>
      </a>
      <a href="tel:+9647817823680" aria-label="Phone">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M6.6 10.2c1.6 3.1 4.1 5.6 7.2 7.2l2.4-2.4c.4-.4 1-.5 1.5-.3 1 .3 2 .5 3 .6 .6 .1 1 .6 1 1.2v3.1c0 .7-.6 1.3-1.3 1.3C9.3 21 3 14.7 3 6.3 3 5.6 3.6 5 4.3 5h3.1c.6 0 1.1 .4 1.2 1 .1 1 .3 2 .6 3 .1 .5 0 1.1-.4 1.5l-2.2 2.7z"/></svg>
      </a>
      <a href="mailto:itechanbar@gmail.com" aria-label="Email">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2zm0 2v.01L12 12l8-6.01V6H4zm16 12V8.5l-8 6-8-6V18Ù‡16z"/></svg>
      </a>
    </div>
    <small>Â© 2025 I.TECH</small>
  </footer>

  <script src="./js/main.js" defer></script>
  <script>
    // --- Helpers (Ù…Ø´Ø§Ø¨Ù‡Ø© Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†Ø§Ù‚ØµØ§Øª) ---
    function utf8ToBase64(str){ try { return btoa(unescape(encodeURIComponent(str))); } catch(e){ return btoa(str); } }
    function encodePathSegments(p){ try { return (p||'').split('/').map(encodeURIComponent).join('/'); } catch { return p; } }
    async function githubGetFileSha(owner, repo, branch, path, token){
      const url = `https://api.github.com/repos/${encodeURIComponent(owner)}/${encodeURIComponent(repo)}/contents/${encodePathSegments(path)}?ref=${encodeURIComponent(branch)}`;
      const headers = { 'Accept':'application/vnd.github+json','Authorization':`Bearer ${token}`,'User-Agent':'I.TECH-Admin/1.0' };
      const r = await fetch(url, { headers });
      if (r.status === 404) return null; if (!r.ok) throw new Error('GitHub API (get sha) failed: '+r.status+' - '+await r.text());
      const j = await r.json(); return j && j.sha ? j.sha : null;
    }
    async function githubPutFile(owner, repo, branch, path, contentBase64, message, shaOrNull, token){
      const url = `https://api.github.com/repos/${encodeURIComponent(owner)}/${encodeURIComponent(repo)}/contents/${encodePathSegments(path)}`;
      const body = { message, content: contentBase64, branch }; if (shaOrNull) body.sha = shaOrNull;
      const headers = { 'Accept':'application/vnd.github+json','Content-Type':'application/json','Authorization':`Bearer ${token}`,'User-Agent':'I.TECH-Admin/1.0' };
      const r = await fetch(url, { method:'PUT', headers, body: JSON.stringify(body) });
      if (!r.ok) throw new Error('GitHub API error '+r.status+': '+await r.text());
      return await r.json();
    }
    async function fetchCurrentProgramsRaw(owner, repo, branch, path){
      const rawUrl = `https://raw.githubusercontent.com/${owner}/${repo}/${encodeURIComponent(branch)}/${path}`;
      const r = await fetch(rawUrl, { cache:'no-store', headers:{ 'Accept':'application/json' } });
      if (r.status === 404) return []; if (!r.ok) throw new Error('Fetch raw failed: '+r.status);
      try { return await r.json(); } catch { return []; }
    }

    // Prefill GitHub fields from LocalStorage
    (function(){
      try {
        const owner = localStorage.getItem('itech_pg_owner'); if (owner) document.getElementById('pg_owner').value = owner;
        const repo = localStorage.getItem('itech_pg_repo'); if (repo) document.getElementById('pg_repo').value = repo;
        const branch = localStorage.getItem('itech_pg_branch'); if (branch) document.getElementById('pg_branch').value = branch;
        const path = localStorage.getItem('itech_pg_path'); if (path) document.getElementById('pg_path').value = path;
        const tok = localStorage.getItem('itech_pg_token'); if (tok) { document.getElementById('pg_token').value = tok; document.getElementById('pg_remember_token').checked = true; }
      } catch {}
    })();

    function setPgStatus(msg, color){
      const statusEl = document.getElementById('programPublishStatus');
      if (!statusEl) return; statusEl.textContent = msg; statusEl.style.color = color || 'var(--text-muted)';
      statusEl.style.display = 'block'; statusEl.style.padding = '10px';
      statusEl.style.border = '1px solid ' + (color || '#ddd'); statusEl.style.borderRadius = '5px';
      statusEl.style.backgroundColor = color === 'green' ? '#d4edda' : color === 'red' ? '#f8d7da' : '#d1ecf1';
    }

    // --- Ù…Ø­Ø±Ø± Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù… Ù…Ø¹ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ ---
    const featuresData = [];
    const formatState = {
      bold: false,
      italic: false,
      underline: false,
      bgColor: '#ffffff',
      fontSize: '14',
      lineHeight: '1.6',
      align: 'right'
    };

    // Helpers Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ø¯Ø§Ø®Ù„ Ù…Ø±Ø¨Ø¹ Ø§Ù„Ù†Øµ
    function getTextAreaSelection() {
      const ta = document.getElementById('feat-text-rich');
      if (!ta) return null;
      const start = typeof ta.selectionStart === 'number' ? ta.selectionStart : 0;
      const end = typeof ta.selectionEnd === 'number' ? ta.selectionEnd : 0;
      return { ta, start, end };
    }

    function wrapSelection(prefix, suffix) {
      const info = getTextAreaSelection();
      if (!info) return false;
      const { ta, start, end } = info;
      if (start === end) return false; // Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªØ­Ø¯ÙŠØ¯
      const value = ta.value;
      const before = value.slice(0, start);
      const selected = value.slice(start, end);
      const after = value.slice(end);
      ta.value = before + prefix + selected + suffix + after;
      const newStart = start + prefix.length;
      const newEnd = newStart + selected.length;
      ta.selectionStart = newStart;
      ta.selectionEnd = newEnd;
      ta.focus();
      updatePreview();
      return true;
    }

    function applySpanStyle(stylePart) {
      const style = stylePart.endsWith(';') ? stylePart : stylePart + ';';
      return wrapSelection(`<span style="${style}">`, `</span>`);
    }

    function applyList(type) {
      const info = getTextAreaSelection();
      if (!info) return;
      const { ta, start, end } = info;
      const value = ta.value;
      const useAll = (start === end);
      const selStart = useAll ? 0 : start;
      const selEnd = useAll ? value.length : end;
      const selected = value.slice(selStart, selEnd);
      const lines = selected.split(/\r?\n/).filter(l => l.trim().length > 0);
      if (!lines.length) return;
      const items = lines.map(l => `<li>${l}</li>`).join('\n');
      const listHtml = `<${type}>\n${items}\n</${type}>`;
      ta.value = value.slice(0, selStart) + listHtml + value.slice(selEnd);
      const pos = selStart + listHtml.length;
      ta.selectionStart = pos;
      ta.selectionEnd = pos;
      ta.focus();
      updatePreview();
    }
    
    // Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ø§Ù„Ø£Ø²Ø±Ø§Ø±
    document.getElementById('fmt-bold')?.addEventListener('click', () => {
      // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ ØªØ­Ø¯ÙŠØ¯ â†’ Ø·Ø¨Ù‚ Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ù…Ø­Ø¯Ø¯ØŒ ÙˆØ¥Ù„Ø§ ØºÙŠÙ‘Ø± Ø§Ù„Ù†Ù…Ø· Ø§Ù„ÙƒØ§Ù…Ù„
      if (!wrapSelection('<strong>', '</strong>')) {
        formatState.bold = !formatState.bold;
        updateFormatButtons();
        updatePreview();
      }
    });
    
    document.getElementById('fmt-italic')?.addEventListener('click', () => {
      if (!wrapSelection('<em>', '</em>')) {
        formatState.italic = !formatState.italic;
        updateFormatButtons();
        updatePreview();
      }
    });
    
    document.getElementById('fmt-underline')?.addEventListener('click', () => {
      if (!wrapSelection('<u>', '</u>')) {
        formatState.underline = !formatState.underline;
        updateFormatButtons();
        updatePreview();
      }
    });
    
    document.getElementById('fmt-bgcolor')?.addEventListener('change', (e) => {
      const color = e.target.value;
      if (!applySpanStyle(`background-color:${color}`)) {
        formatState.bgColor = color;
        updatePreview();
      }
    });
    
    document.getElementById('fmt-size')?.addEventListener('change', (e) => {
      const size = e.target.value;
      if (!applySpanStyle(`font-size:${size}px`)) {
        formatState.fontSize = size;
        updatePreview();
      }
    });
    
    document.getElementById('fmt-lineheight')?.addEventListener('change', (e) => {
      formatState.lineHeight = e.target.value || '1.6';
      updatePreview();
    });

    // Ù…Ø­Ø§Ø°Ø§Ø© Ø§Ù„ÙÙ‚Ø±Ø©
    document.getElementById('fmt-align-right')?.addEventListener('click', () => {
      formatState.align = 'right';
      updateFormatButtons();
      updatePreview();
    });
    document.getElementById('fmt-align-center')?.addEventListener('click', () => {
      formatState.align = 'center';
      updateFormatButtons();
      updatePreview();
    });
    document.getElementById('fmt-align-left')?.addEventListener('click', () => {
      formatState.align = 'left';
      updateFormatButtons();
      updatePreview();
    });

    // Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…
    document.getElementById('fmt-ul')?.addEventListener('click', () => applyList('ul'));
    document.getElementById('fmt-ol')?.addEventListener('click', () => applyList('ol'));
    
    document.getElementById('fmt-emoji')?.addEventListener('click', () => {
      const emojis = ['âœ“', 'âœ“âœ“', 'â˜…', 'â—', 'â†’', 'âš¡', 'ğŸ¯', 'âœ¨', 'ğŸ”¥', 'ğŸ’¯', 'ğŸš€', 'â­'];
      const selected = emojis[Math.floor(Math.random() * emojis.length)];
      const ta = document.getElementById('feat-text-rich');
      ta.value += selected;
      updatePreview();
      ta.focus();
    });
    
    document.getElementById('fmt-clear')?.addEventListener('click', () => {
      formatState.bold = false;
      formatState.italic = false;
      formatState.underline = false;
      formatState.bgColor = '#ffffff';
      formatState.fontSize = '14';
      formatState.lineHeight = '1.6';
      formatState.align = 'right';
      updateFormatButtons();
      updatePreview();
    });
    
    function updateFormatButtons() {
      const boldBtn = document.getElementById('fmt-bold');
      const italicBtn = document.getElementById('fmt-italic');
      const underlineBtn = document.getElementById('fmt-underline');
      const alignRightBtn = document.getElementById('fmt-align-right');
      const alignCenterBtn = document.getElementById('fmt-align-center');
      const alignLeftBtn = document.getElementById('fmt-align-left');

      if (boldBtn) {
        boldBtn.style.background = formatState.bold ? 'var(--primary)' : 'var(--surface)';
        boldBtn.style.color = formatState.bold ? 'white' : 'var(--text-main)';
      }
      if (italicBtn) {
        italicBtn.style.background = formatState.italic ? 'var(--primary)' : 'var(--surface)';
        italicBtn.style.color = formatState.italic ? 'white' : 'var(--text-main)';
      }
      if (underlineBtn) {
        underlineBtn.style.background = formatState.underline ? 'var(--primary)' : 'var(--surface)';
        underlineBtn.style.color = formatState.underline ? 'white' : 'var(--text-main)';
      }

      const makeAlignStyle = (btn, active) => {
        if (!btn) return;
        btn.style.background = active ? 'var(--primary)' : 'var(--surface)';
        btn.style.color = active ? 'white' : 'var(--text-main)';
      };

      makeAlignStyle(alignRightBtn, formatState.align === 'right');
      makeAlignStyle(alignCenterBtn, formatState.align === 'center');
      makeAlignStyle(alignLeftBtn, formatState.align === 'left');
    }
    
    function updatePreview() {
      const ta = document.getElementById('feat-text-rich');
      const preview = document.getElementById('feat-preview-text');
      if (!ta || !preview) return;

      const text = ta.value;
      if (!text) {
        preview.innerHTML = '<span style="color:var(--text-muted);">Ø³ÙŠØ¸Ù‡Ø± Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ù†Ø³Ù‚ Ù‡Ù†Ø§...</span>';
        return;
      }

      // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø¹Ù„Ù‰ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ù†ÙØ³Ù‡ Ù…Ø¹ Ø¯Ø¹Ù… HTML Ø¬Ø²Ø¦ÙŠ ÙˆÙÙˆØ§ØµÙ„ Ø§Ù„Ø£Ø³Ø·Ø±
      preview.innerHTML = text;
      preview.style.whiteSpace = 'pre-wrap';
      preview.style.fontWeight = formatState.bold ? 'bold' : 'normal';
      preview.style.fontStyle = formatState.italic ? 'italic' : 'normal';
      preview.style.textDecoration = formatState.underline ? 'underline' : 'none';
      preview.style.backgroundColor = formatState.bgColor;
      preview.style.fontSize = formatState.fontSize + 'px';
      preview.style.lineHeight = formatState.lineHeight;
      preview.style.textAlign = formatState.align;
      preview.style.padding = '4px 6px';
      preview.style.borderRadius = '3px';
    }
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¹Ù†Ø¯ Ø§Ù„ÙƒØªØ§Ø¨Ø©
    document.getElementById('feat-text-rich')?.addEventListener('input', updatePreview);
    
    function renderFeaturesPreview() {
      const preview = document.getElementById('featuresPreview');
      if (!preview) return;
      if (featuresData.length === 0) {
        preview.innerHTML = '<p class="muted" style="margin:0;text-align:center;">Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù…ÙŠØ²Ø§Øª</p>';
        return;
      }
      preview.innerHTML = featuresData.map((feat, idx) => {
        const styleStr = feat.style || 'font-weight:normal;font-style:normal;text-decoration:none;';
        const color = feat.color ? `border-left:4px solid ${feat.color};background-color:${feat.color}15;` : 'background:var(--bg-hover);border-left:4px solid var(--primary);';
        const link = feat.link ? `<a href="${feat.link}" target="_blank" style="color:var(--primary);margin-left:8px;text-decoration:none;font-size:12px;">ğŸ”—</a>` : '';
        const text = (feat.text || '').toString();
        return `
          <div style="padding:8px;margin-bottom:4px;border-radius:4px;${color}display:flex;justify-content:space-between;align-items:center;">
            <span style="${styleStr};white-space:pre-wrap;">${text} ${link}</span>
            <button data-idx="${idx}" class="btn-remove-feat" style="border:none;background:rgba(255,0,0,0.1);color:red;cursor:pointer;padding:2px 6px;border-radius:3px;font-size:12px;">Ø­Ø°Ù</button>
          </div>
        `;
      }).join('');
      
      document.querySelectorAll('.btn-remove-feat').forEach(btn => {
        btn.addEventListener('click', () => {
          const idx = parseInt(btn.getAttribute('data-idx'));
          featuresData.splice(idx, 1);
          renderFeaturesPreview();
          updateFeaturesTextarea();
        });
      });
    }

    function updateFeaturesTextarea() {
      const ta = document.getElementById('p_features');
      if (ta) ta.value = JSON.stringify(featuresData.map(f => ({ text: f.text, link: f.link, color: f.color, style: f.style })));
    }

    document.getElementById('btnAddFeature')?.addEventListener('click', () => {
      const text = (document.getElementById('feat-text-rich')?.value || '').trim();
      if (!text) { alert('Ø£Ø¯Ø®Ù„ Ù†Øµ Ø§Ù„Ù…ÙŠØ²Ø© Ø£ÙˆÙ„Ø§Ù‹'); return; }
      const link = (document.getElementById('feat-link')?.value || '').trim();
      const color = (document.getElementById('feat-color')?.value || '');
      
      const styleStr = `
        font-weight: ${formatState.bold ? 'bold' : 'normal'};
        font-style: ${formatState.italic ? 'italic' : 'normal'};
        text-decoration: ${formatState.underline ? 'underline' : 'none'};
        background-color: ${formatState.bgColor === '#ffffff' ? 'transparent' : formatState.bgColor};
        font-size: ${formatState.fontSize}px;
        line-height: ${formatState.lineHeight};
        text-align: ${formatState.align};
      `;
      
      featuresData.push({ text, link: link || null, color: color || null, style: styleStr });
      
      // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
      document.getElementById('feat-text-rich').value = '';
      document.getElementById('feat-link').value = '';
      document.getElementById('feat-color').value = '';
      formatState.bold = false;
      formatState.italic = false;
      formatState.underline = false;
      formatState.bgColor = '#ffffff';
      formatState.fontSize = '14';
      document.getElementById('fmt-size').value = '14';
      
      updateFormatButtons();
      updatePreview();
      renderFeaturesPreview();
      updateFeaturesTextarea();
      document.getElementById('feat-text-rich').focus();
    });

    // Ù…ÙØªØ§Ø­ Enter
    document.getElementById('feat-text-rich')?.addEventListener('keypress', (e) => {
      if (e.key === 'Enter' && e.ctrlKey) document.getElementById('btnAddFeature').click();
    });
    
    function setPgStatus(msg, color){
      const statusEl = document.getElementById('programPublishStatus');
      if (!statusEl) return; statusEl.textContent = msg; statusEl.style.color = color || 'var(--text-muted)';
      statusEl.style.display = 'block'; statusEl.style.padding = '10px';
      statusEl.style.border = '1px solid ' + (color || '#ddd'); statusEl.style.borderRadius = '5px';
      statusEl.style.backgroundColor = color === 'green' ? '#d4edda' : color === 'red' ? '#f8d7da' : '#d1ecf1';
    }

    function renderFeaturesPreview() {
      const preview = document.getElementById('featuresPreview');
      if (!preview) return;
      if (featuresData.length === 0) {
        preview.innerHTML = '<p class="muted" style="margin:0;text-align:center;">Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù…ÙŠØ²Ø§Øª</p>';
        return;
      }
      preview.innerHTML = featuresData.map((feat, idx) => {
        const style = feat.color ? `background-color:${feat.color}15;border-left:4px solid ${feat.color};` : 'background:var(--bg-hover);border-left:4px solid var(--primary);';
        const link = feat.link ? `<a href="${feat.link}" target="_blank" style="color:var(--primary);margin-left:8px;text-decoration:none;">ğŸ”—</a>` : '';
        const bold = feat.bold ? 'font-weight:700;' : '';
        const text = (feat.text || '').toString();
        return `
          <div style="padding:8px;margin-bottom:4px;border-radius:4px;${style}${bold}display:flex;justify-content:space-between;align-items:center;">
            <span style="white-space:pre-wrap;">${text} ${link}</span>
            <button data-idx="${idx}" class="btn-remove-feat" style="border:none;background:rgba(255,0,0,0.1);color:red;cursor:pointer;padding:2px 6px;border-radius:3px;font-size:12px;">Ø­Ø°Ù</button>
          </div>
        `;
      }).join('');
      
      // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹Ø§Øª Ø§Ù„Ø­Ø°Ù
      document.querySelectorAll('.btn-remove-feat').forEach(btn => {
        btn.addEventListener('click', () => {
          const idx = parseInt(btn.getAttribute('data-idx'));
          featuresData.splice(idx, 1);
          renderFeaturesPreview();
          updateFeaturesTextarea();
        });
      });
    }

    document.getElementById('btnAddFeature')?.addEventListener('click', () => {
      const text = (document.getElementById('feat-text-rich')?.value || '').trim();
      if (!text) { alert('Ø£Ø¯Ø®Ù„ Ù†Øµ Ø§Ù„Ù…ÙŠØ²Ø© Ø£ÙˆÙ„Ø§Ù‹'); return; }
      const link = (document.getElementById('feat-link')?.value || '').trim();
      const color = (document.getElementById('feat-color')?.value || '');
      
      const styleStr = `
        font-weight: ${formatState.bold ? 'bold' : 'normal'};
        font-style: ${formatState.italic ? 'italic' : 'normal'};
        text-decoration: ${formatState.underline ? 'underline' : 'none'};
        background-color: ${formatState.bgColor === '#ffffff' ? 'transparent' : formatState.bgColor};
        font-size: ${formatState.fontSize}px;
        line-height: ${formatState.lineHeight};
        text-align: ${formatState.align};
      `;
      
      featuresData.push({ text, link: link || null, color: color || null, style: styleStr });
      
      // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
      document.getElementById('feat-text-rich').value = '';
      document.getElementById('feat-link').value = '';
      document.getElementById('feat-color').value = '';
      formatState.bold = false;
      formatState.italic = false;
      formatState.underline = false;
      formatState.bgColor = '#ffffff';
      formatState.fontSize = '14';
      document.getElementById('fmt-size').value = '14';
      
      updateFormatButtons();
      updatePreview();
      renderFeaturesPreview();
      updateFeaturesTextarea();
    });
    
    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…ÙØªØ§Ø­ Enter ÙÙŠ Ø­Ù‚Ù„ Ø§Ù„Ù†Øµ
    document.getElementById('feat-text-rich')?.addEventListener('keypress', (e) => {
      if (e.key === 'Enter' && e.ctrlKey) document.getElementById('btnAddFeature').click();
    });

    function setPgStatus(msg, color){
      const statusEl = document.getElementById('programPublishStatus');
      if (!statusEl) return; statusEl.textContent = msg; statusEl.style.color = color || 'var(--text-muted)';
      statusEl.style.display = 'block'; statusEl.style.padding = '10px';
      statusEl.style.border = '1px solid ' + (color || '#ddd'); statusEl.style.borderRadius = '5px';
      statusEl.style.backgroundColor = color === 'green' ? '#d4edda' : color === 'red' ? '#f8d7da' : '#d1ecf1';
    }

    function buildProgramItem(){
      const name = (document.getElementById('p_name').value||'').trim();
      const desc = (document.getElementById('p_desc').value||'').trim();
      const logo = (document.getElementById('p_logo').value||'').trim();
      const image = (document.getElementById('p_image').value||'').trim();
      const price = (document.getElementById('p_price').value||'').trim();
      const currency = (document.getElementById('p_currency').value||'IQD').trim();
      const imgs = [];
      for(let i=1;i<=10;i++){ const v = (document.getElementById('p_img'+i).value||'').trim(); if (v) imgs.push(v); }
      const vids = [];
      for(let i=1;i<=2;i++){ const v = (document.getElementById('p_vid'+i).value||'').trim(); if (v) vids.push(v); }
      const existingId = (document.getElementById('p_id').value||'').trim();
      const id = existingId || ((name ? name.replace(/\s+/g,'-').toLowerCase() : 'program') + '-' + Date.now());
      // Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù…Ø­Ø±Ø± Ø§Ù„Ù…ÙŠØ²Ø§Øª Ù…Ø¹ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø£Ùˆ Ø§Ù‚Ø±Ø£ Ù…Ù† textarea
      const features = featuresData.length > 0 
        ? featuresData 
        : (document.getElementById('p_features').value||'')
            .split(';')
            .map(s=>s.trim())
            .filter(Boolean)
            .map(text => ({ text, link: null, color: null, style: '' }));
      return {
        id,
        name,
        logo,
        image,
        shortDescription: desc,
        price: price ? Number(price) : undefined,
        currency,
        images: imgs,
        videos: vids,
        features,
        link: '#'
      };
    }

    async function renderProgramsAdminList(){
      const owner = (document.getElementById('pg_owner').value||'').trim();
      const repo = (document.getElementById('pg_repo').value||'').trim();
      const branch = (document.getElementById('pg_branch').value||'main').trim();
      const path = (document.getElementById('pg_path').value||'assets/data/programs.json').trim();
      const wrap = document.getElementById('programsAdminList');
      if (!wrap) return;
      if (!owner || !repo || !branch || !path){ wrap.innerHTML = '<div class="muted">Ø£ÙƒÙ…Ù„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª GitHub Ø«Ù… Ø§Ø¶ØºØ· "ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©".</div>'; return; }
      wrap.innerHTML = '<div class="muted">Ø¬Ù„Ø¨ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©...</div>';
      try {
        const arr = await fetchCurrentProgramsRaw(owner, repo, branch, path);
        const rawUrl = `https://raw.githubusercontent.com/${owner}/${repo}/${encodeURIComponent(branch)}/${path}`;
        if (!Array.isArray(arr) || arr.length === 0){ wrap.innerHTML = '<div class="muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ø±Ø§Ù…Ø¬ Ø­Ø§Ù„ÙŠØ§Ù‹.<br>Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ­Ù‚Ù‚: <a href="'+rawUrl+'" target="_blank" rel="noopener">'+rawUrl+'</a></div>'; return; }
        const table = document.createElement('table'); table.className='table'; table.style.width='100%';
        table.innerHTML = '<thead><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ø³Ø¹Ø±</th><th>ØµÙˆØ±</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead><tbody></tbody>';
        const tbody = table.querySelector('tbody');
        arr.forEach(item=>{
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${item.name||''}</td><td>${item.price!=null?item.price+(item.currency?' '+item.currency:''):''}</td><td>${Array.isArray(item.images)?item.images.length:0}</td><td><button class="btn" data-act="edit">ØªØ­Ø±ÙŠØ±</button> <button class="btn" data-act="del">Ø­Ø°Ù</button></td>`;
          tr.querySelector('[data-act="edit"]').addEventListener('click', ()=>{
            try {
              document.getElementById('p_id').value = item.id||'';
              document.getElementById('p_name').value = item.name||'';
              document.getElementById('p_desc').value = item.shortDescription||'';
              document.getElementById('p_logo').value = item.logo||'';
              document.getElementById('p_image').value = item.image||'';
              document.getElementById('p_price').value = item.price!=null?String(item.price):'';
              document.getElementById('p_currency').value = item.currency||'IQD';
              
              // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø¥Ù„Ù‰ Ù…Ø­Ø±Ø± Ø§Ù„Ù…ÙŠØ²Ø§Øª
              featuresData.length = 0;
              if (Array.isArray(item.features)) {
                item.features.forEach(f => {
                  if (typeof f === 'object' && f.text) {
                    featuresData.push(f);
                  } else if (typeof f === 'string') {
                    featuresData.push({ text: f, link: null, color: null, style: '' });
                  }
                });
              }
              renderFeaturesPreview();
              
              // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ø³ÙŠÙ‚
              formatState.bold = false;
              formatState.italic = false;
              formatState.underline = false;
              formatState.textColor = '#000000';
              formatState.bgColor = '#ffffff';
              formatState.fontSize = '14';
              document.getElementById('feat-text-rich').value = '';
              document.getElementById('fmt-size').value = '14';
              updateFormatButtons();
              updatePreview();
              
              // fill images/videos
              for(let i=1;i<=10;i++){
                const val = (Array.isArray(item.images) && item.images[i-1]) ? item.images[i-1] : '';
                const el = document.getElementById('p_img'+i); if (el) el.value = val||'';
              }
              for(let i=1;i<=2;i++){
                const val = (Array.isArray(item.videos) && item.videos[i-1]) ? item.videos[i-1] : '';
                const el = document.getElementById('p_vid'+i); if (el) el.value = val||'';
              }
              setPgStatus('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ ÙÙŠ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬. Ø¹Ø¯Ù‘Ù„ Ø«Ù… Ø§Ø¶ØºØ· Ù†Ø´Ø±.', 'blue');
            } catch(e){ setPgStatus('ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ­Ø±ÙŠØ±: '+(e&&e.message?e.message:String(e)), 'red'); }
          });
          tr.querySelector('[data-act="del"]').addEventListener('click', async ()=>{
            if (!confirm('ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ØŸ Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ù Ø¹Ù„Ù‰ GitHub.')) return;
            try {
              const owner = (document.getElementById('pg_owner').value||'').trim();
              const repo = (document.getElementById('pg_repo').value||'').trim();
              const branch = (document.getElementById('pg_branch').value||'main').trim();
              const path = (document.getElementById('pg_path').value||'assets/data/programs.json').trim();
              const token = (document.getElementById('pg_token').value||'').trim();
              if (!owner||!repo||!branch||!path||!token){ setPgStatus('Ø£ÙƒÙ…Ù„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª GitHub Ø£ÙˆÙ„Ø§Ù‹', 'red'); return; }
              const list = await fetchCurrentProgramsRaw(owner, repo, branch, path);
              const next = Array.isArray(list) ? list.filter(x => String(x.id||'') !== String(item.id||'')) : [];
              const newJson = JSON.stringify(next, null, 2) + '\n';
              const sha = await githubGetFileSha(owner, repo, branch, path, token);
              const res = await githubPutFile(owner, repo, branch, path, utf8ToBase64(newJson), `Delete program ${item.id}`, sha, token);
              setPgStatus('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ âœ”' + (res && res.commit && res.commit.html_url ? ` â€” ${res.commit.html_url}` : ''), 'green');
              try { localStorage.removeItem('itech_programs_cache'); } catch {}
              await renderProgramsAdminList();
            } catch(e){ setPgStatus('ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù: '+(e&&e.message?e.message:String(e)), 'red'); }
          });
          tbody.appendChild(tr);
        });
        wrap.innerHTML=''; wrap.appendChild(table);
      } catch (e){ wrap.innerHTML = '<div class="muted">ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©: '+(e&&e.message?e.message:String(e))+'</div>'; }
    }

    document.getElementById('btnRefreshPrograms').addEventListener('click', renderProgramsAdminList);
    document.getElementById('btnClearProgramsCache').addEventListener('click', () => { try { localStorage.removeItem('itech_programs_cache'); alert('ØªÙ… Ù…Ø³Ø­ ÙƒØ§Ø´ Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ âœ” Ø§ÙØªØ­ ØµÙØ­Ø© Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø¨Ù€ ?nocache=1 Ù„Ù‚Ø±Ø§Ø¡Ø© Ø£Ø­Ø¯Ø« Ù†Ø³Ø®Ø©.'); } catch {} });

    document.getElementById('btnTestPgConnection').addEventListener('click', async ()=>{
      setPgStatus('Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„...', 'blue');
      try {
        const owner = (document.getElementById('pg_owner').value||'').trim();
        const repo = (document.getElementById('pg_repo').value||'').trim();
        const token = (document.getElementById('pg_token').value||'').trim();
        if (!owner || !repo || !token){ setPgStatus('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Owner, Repo, Ùˆ Token', 'red'); return; }
        const repoUrl = `https://api.github.com/repos/${encodeURIComponent(owner)}/${encodeURIComponent(repo)}`;
        const response = await fetch(repoUrl, { headers: { 'Authorization':`Bearer ${token}`,'Accept':'application/vnd.github+json','User-Agent':'I.TECH-Admin/1.0' } });
        if (response.ok){ const info = await response.json(); setPgStatus(`âœ… Ø§Ù„Ø§ØªØµØ§Ù„ Ù†Ø§Ø¬Ø­: ${info.full_name}`, 'green'); }
        else if (response.status===401){ setPgStatus('âŒ Token ØºÙŠØ± ØµØ­ÙŠØ­ Ø£Ùˆ Ù…Ù†ØªÙ‡ÙŠ', 'red'); }
        else if (response.status===403){ setPgStatus('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙ„Ø§Ø­ÙŠØ© Ù„Ù„ÙˆØµÙˆÙ„/Ø§Ù„ÙƒØªØ§Ø¨Ø©', 'red'); }
        else { setPgStatus('âŒ Ø®Ø·Ø£ '+response.status+': '+await response.text(), 'red'); }
      } catch (e){ setPgStatus('âŒ ÙØ´Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±: '+(e&&e.message?e.message:String(e)), 'red'); }
    });

    document.getElementById('btnPublishProgram').addEventListener('click', async ()=>{
      setPgStatus('Ø¨Ø¯Ø¡ Ø§Ù„Ù†Ø´Ø± Ø¥Ù„Ù‰ GitHub...', 'blue');
      const name = (document.getElementById('p_name').value||'').trim();
      if (!name){ setPgStatus('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬', 'red'); alert('Ø§Ø³Ù… Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ù…Ø·Ù„ÙˆØ¨'); return; }
      const item = buildProgramItem();
      const owner = (document.getElementById('pg_owner').value||'').trim();
      const repo = (document.getElementById('pg_repo').value||'').trim();
      const branch = (document.getElementById('pg_branch').value||'main').trim();
      const path = (document.getElementById('pg_path').value||'assets/data/programs.json').trim();
      const token = (document.getElementById('pg_token').value||'').trim();
      if (!owner || !repo || !branch || !path || !token){ setPgStatus('Ø£ÙƒÙ…Ù„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª GitHub ÙˆØ§Ù„Ø±Ù…Ø² (PAT)', 'red'); alert('Ø£ÙƒÙ…Ù„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª GitHub ÙˆØ§Ù„Ø±Ù…Ø²'); return; }
      try {
        // remember preferences
        try {
          localStorage.setItem('itech_pg_owner', owner);
          localStorage.setItem('itech_pg_repo', repo);
          localStorage.setItem('itech_pg_branch', branch);
          localStorage.setItem('itech_pg_path', path);
          const remember = document.getElementById('pg_remember_token').checked; if (remember) localStorage.setItem('itech_pg_token', token); else localStorage.removeItem('itech_pg_token');
        } catch {}

        // fetch current
        setPgStatus('Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø­Ø§Ù„ÙŠ...', 'blue');
        let arr = [];
        try { arr = await fetchCurrentProgramsRaw(owner, repo, branch, path); } catch { arr = []; }
        // add or update item by id
        const idx = Array.isArray(arr) ? arr.findIndex(x => String(x.id||'') === String(item.id||'')) : -1;
        if (idx >= 0) {
          arr[idx] = item;
          setPgStatus('Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯...', 'orange');
        } else {
          arr.push(item);
        }
        const newJson = JSON.stringify(arr, null, 2) + '\n';

        // get sha and publish
        setPgStatus('Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ SHA...', 'blue');
        let sha = null; try { sha = await githubGetFileSha(owner, repo, branch, path, token); } catch { sha = null; }
        setPgStatus('Ø±ÙØ¹ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¥Ù„Ù‰ GitHub...', 'blue');
        const res = await githubPutFile(owner, repo, branch, path, utf8ToBase64(newJson), `${idx>=0?'Update':'Add'} program ${item.id}`, sha, token);
        const commitUrl = (res && res.commit && res.commit.html_url) ? res.commit.html_url : '';
        const fileUrl = (res && res.content && res.content.html_url) ? res.content.html_url : '';
        setPgStatus('ØªÙ… Ø§Ù„Ù†Ø´Ø± Ø¨Ù†Ø¬Ø§Ø­ âœ”' + (commitUrl ? ` â€” Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ£ÙƒÙŠØ¯: ${commitUrl}` : ''), 'green');
        try { localStorage.removeItem('itech_programs_cache'); } catch {}
        alert('ØªÙ… Ù†Ø´Ø± Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¨Ù†Ø¬Ø§Ø­ âœ”\nØ³ÙŠØ¸Ù‡Ø± ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø¨Ø¹Ø¯ ØªØ­Ø¯ÙŠØ« GitHub Pages.' + (commitUrl ? '\n\nØ±Ø§Ø¨Ø· Ø§Ù„Ù€ Commit: '+commitUrl : ''));

        // clear fields
        try {
          ['p_name','p_desc','p_logo','p_image','p_price','p_currency','p_vid1','p_vid2','p_id','p_features'].forEach(id=>{ const el=document.getElementById(id); if (el) el.value=''; });
          for(let i=1;i<=10;i++){ const el=document.getElementById('p_img'+i); if (el) el.value=''; }
          
          // Ù…Ø³Ø­ Ù…Ø­Ø±Ø± Ø§Ù„Ù…ÙŠØ²Ø§Øª ÙˆØ§Ù„ØªÙ†Ø³ÙŠÙ‚
          featuresData.length = 0;
          document.getElementById('feat-text-rich').value = '';
          document.getElementById('feat-link').value = '';
          document.getElementById('feat-color').value = '';
          formatState.bold = false;
          formatState.italic = false;
          formatState.underline = false;
          formatState.bgColor = '#ffffff';
          formatState.fontSize = '14';
          document.getElementById('fmt-size').value = '14';
          
          renderFeaturesPreview();
          updateFormatButtons();
          updatePreview();
        } catch {}

        // refresh admin list
        try { await renderProgramsAdminList(); } catch {}
      } catch (e){ setPgStatus('ÙØ´Ù„ Ø§Ù„Ù†Ø´Ø±: '+(e&&e.message?e.message:String(e)), 'red'); alert('Ø®Ø·Ø£: '+(e&&e.message?e.message:String(e))); }
    });

    // auto-render if fields prefilled
    try {
      const owner = (document.getElementById('pg_owner').value||'').trim();
      const repo = (document.getElementById('pg_repo').value||'').trim();
      const path = (document.getElementById('pg_path').value||'').trim();
      if (owner && repo && path) renderProgramsAdminList();
    } catch {}
  </script>
</body>
</html>
