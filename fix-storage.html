<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø¥ØµÙ„Ø§Ø­ localStorage</title>
  <style>
    body { 
      font-family: Arial, sans-serif; 
      margin: 20px; 
      background: #f5f5f5;
      direction: rtl;
    }
    .container {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      max-width: 600px;
      margin: 0 auto;
    }
    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
      margin: 10px;
      font-size: 16px;
    }
    button:hover { background: #0056b3; }
    .clear-btn { background: #dc3545; }
    .clear-btn:hover { background: #c82333; }
    .status {
      padding: 15px;
      border-radius: 4px;
      margin: 10px 0;
      font-weight: bold;
    }
    .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
    .data-display {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      padding: 15px;
      margin: 10px 0;
      max-height: 300px;
      overflow-y: auto;
      font-family: monospace;
      font-size: 12px;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Ø¥ØµÙ„Ø§Ø­ Ø¨ÙŠØ§Ù†Ø§Øª localStorage</h1>
    
    <h3>Ø­Ø§Ù„Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</h3>
    <div id="status"></div>
    
    <h3>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©:</h3>
    <button onclick="checkData()">ÙØ­Øµ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
    <button onclick="fixData()">Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
    <button onclick="clearData()" class="clear-btn">Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ø·ÙˆØ¨Ø©</button>
    <button onclick="refreshPage()">ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©</button>
    
    <h3>Ù…Ø­ØªÙˆÙ‰ localStorage:</h3>
    <div id="dataDisplay" class="data-display">Ù„Ù… ÙŠØªÙ… ÙØ­Øµ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯</div>
  </div>

  <script>
    const STORAGE_KEY = 'updated_tenders_data';
    
    function showStatus(message, type = 'info') {
      document.getElementById('status').innerHTML = `<div class="status ${type}">${message}</div>`;
    }
    
    function displayData(data, title = 'Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª') {
      document.getElementById('dataDisplay').textContent = `${title}:\n${JSON.stringify(data, null, 2)}`;
    }
    
    function checkData() {
      try {
        const stored = localStorage.getItem(STORAGE_KEY);
        if (!stored) {
          showStatus('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ localStorage', 'info');
          displayData(null, 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª');
          return;
        }
        
        const parsed = JSON.parse(stored);
        displayData(parsed, 'Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©');
        
        if (Array.isArray(parsed)) {
          showStatus(`âœ… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØµØ­ÙŠØ­Ø© - Ù…ØµÙÙˆÙØ© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ${parsed.length} Ø¹Ù†ØµØ±`, 'success');
        } else if (parsed && Array.isArray(parsed.data)) {
          showStatus(`âœ… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØµØ­ÙŠØ­Ø© - ÙƒØ§Ø¦Ù† ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ${parsed.data.length} Ù…Ù†Ø§Ù‚ØµØ©`, 'success');
        } else {
          showStatus('âŒ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹Ø·ÙˆØ¨Ø© - Ù„ÙŠØ³Øª Ù…ØµÙÙˆÙØ© Ø£Ùˆ ÙƒØ§Ø¦Ù† ØµØ­ÙŠØ­', 'error');
        }
      } catch (error) {
        showStatus('âŒ Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + error.message, 'error');
        displayData(error.message, 'Ø®Ø·Ø£');
      }
    }
    
    async function fixData() {
      try {
        const stored = localStorage.getItem(STORAGE_KEY);
        if (!stored) {
          showStatus('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¥ØµÙ„Ø§Ø­Ù‡Ø§', 'info');
          return;
        }
        
        const parsed = JSON.parse(stored);
        
        if (Array.isArray(parsed)) {
          showStatus('Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø³Ù„ÙŠÙ…Ø© ÙˆÙ„Ø§ ØªØ­ØªØ§Ø¬ Ø¥ØµÙ„Ø§Ø­', 'success');
          return;
        }
        
        if (parsed && Array.isArray(parsed.data)) {
          showStatus('Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø³Ù„ÙŠÙ…Ø© ÙˆÙ„Ø§ ØªØ­ØªØ§Ø¬ Ø¥ØµÙ„Ø§Ø­', 'success');
          return;
        }
        
        // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ©
        const response = await fetch('./assets/data/tenders.json');
        const originalData = await response.json();
        
        // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø§Ù„Ø´ÙƒÙ„ Ø§Ù„ØµØ­ÙŠØ­
        localStorage.setItem(STORAGE_KEY, JSON.stringify({
          data: originalData,
          lastUpdate: new Date().toISOString(),
          version: Date.now(),
          source: 'restored_from_original'
        }));
        
        showStatus('âœ… ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø£ØµÙ„ÙŠ', 'success');
        checkData();
        
      } catch (error) {
        showStatus('âŒ ÙØ´Ù„ ÙÙŠ Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + error.message, 'error');
      }
    }
    
    function clearData() {
      if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ')) {
        localStorage.removeItem(STORAGE_KEY);
        showStatus('ğŸ—‘ï¸ ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† localStorage', 'info');
        displayData(null, 'ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
      }
    }
    
    function refreshPage() {
      window.location.href = 'tenders-new.html';
    }
    
    // ÙØ­Øµ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
    window.addEventListener('load', checkData);
  </script>
</body>
</html>